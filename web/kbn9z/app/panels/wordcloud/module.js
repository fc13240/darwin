/*! kibana - v3.1.2 - 2015-08-24
 * Copyright (c) 2015 Rashid Khan; Licensed Apache License */

define("panels/wordcloud/module",["angular","app","lodash","jquery","config","echarts"],function(a,b,c,d){"use strict";var e=a.module("kibana.panels.wordcloud",[]);b.useModule(e),e.controller("wordcloud",["$scope","$rootScope","querySrv","dashboard","filterSrv",function(b,d,e,f,g){b.panelMeta={editorTabs:[],modals:[{description:"Inspect",icon:"icon-info-sign",partial:"app/partials/inspector.html",show:b.panel.spyable}]};var h={map:"china",colors:["#A0E2E2","#265656"],size:100,exclude:[],spyable:!0,queries:{mode:"all",ids:[]}};c.defaults(b.panel,h),b.init=function(){b.get_data()},b.get_data=function(){if(0!==f.indices.length){b.panelMeta.loading=!0;var a,d,h;b.panel.queries.ids=e.idsByMode(b.panel.queries),a=b.ejs.Request().indices(f.indices),h=e.getQueryObjs(b.panel.queries.ids),d=b.ejs.BoolQuery(),c.each(h,function(a){d=d.should(e.toEjsObj(a))}),a=a.facet(b.ejs.TermsFacet("wordcloud").field(b.panel.field).size(b.panel.size).exclude(b.panel.exclude).facetFilter(b.ejs.QueryFilter(b.ejs.FilteredQuery(d,g.getBoolFilter(g.ids()))))).size(0),b.populate_modal(a);var i=a.doSearch();i.then(function(a){b.panelMeta.loading=!1,b.hits=a.hits.total,b.data=[],c.each(a.facets.wordcloud.terms,function(a){var c={};c.name=a.term.toUpperCase(),c.value=a.count,b.data.push(c)}),b.$emit("render")})}},b.populate_modal=function(c){b.inspector=a.toJson(JSON.parse(c.toString()),!0)},b.build_search=function(a,b){g.set({type:"field",field:a,query:b,mandate:"must"})}}]),e.directive("wordcloud",function(){return{restrict:"EA",link:function(a,b){function d(){b.empty(),b.css({height:500});var c=echarts.init(b[0]),d=function(){return{normal:{color:"rgb("+[Math.round(300*Math.random()),Math.round(200*Math.random()),Math.round(400*Math.random())].join(",")+")"}}};a.option={title:{text:"Google Trends",link:"http://www.google.com/trends/hottrends"},tooltip:{show:!0},series:[{name:"Google Trends",type:"wordCloud",size:["80%","80%"],textRotation:[0,45,90,-45],textPadding:0,autoSize:{enable:!0,minSize:14},data:[{name:"Sam S Club",value:1e4,itemStyle:{normal:{color:"black"}}},{name:"Macys",value:6181,itemStyle:d()},{name:"Amy Schumer",value:4386,itemStyle:d()},{name:"Jurassic World",value:4055,itemStyle:d()},{name:"Charter Communications",value:2467,itemStyle:d()},{name:"Chick Fil A",value:2244,itemStyle:d()},{name:"Planet Fitness",value:1898,itemStyle:d()},{name:"Pitch Perfect",value:1484,itemStyle:d()},{name:"Express",value:1112,itemStyle:d()},{name:"Home",value:965,itemStyle:d()},{name:"Johnny Depp",value:847,itemStyle:d()},{name:"Lena Dunham",value:582,itemStyle:d()},{name:"Lewis Hamilton",value:555,itemStyle:d()},{name:"KXAN",value:550,itemStyle:d()},{name:"Mary Ellen Mark",value:462,itemStyle:d()},{name:"Farrah Abraham",value:366,itemStyle:d()},{name:"Rita Ora",value:360,itemStyle:d()},{name:"Serena Williams",value:282,itemStyle:d()},{name:"NCAA baseball tournament",value:273,itemStyle:d()},{name:"Point Break",value:265,itemStyle:d()}]}]},c.setOption(a.option,!0)}console.log(a.data),b.html('<center><img src="img/load_big.gif"></center>'),a.$on("render",function(){e()}),b.closest(".panel").resize(function(){b.empty()});var e=c.debounce(d,200)}}})});