/*! kibana - v3.1.2 - 2015-07-29
 * Copyright (c) 2015 Rashid Khan; Licensed Apache License */

function jsonPath(obj,expr,arg){var P={resultType:arg&&arg.resultType||"VALUE",result:[],normalize:function(a){var b=[];return a.replace(/[\['](\??\(.*?\))[\]']/g,function(a,c){return"[#"+(b.push(c)-1)+"]"}).replace(/'?\.'?|\['?/g,";").replace(/;;;|;;/g,";..;").replace(/;$|'?\]|'$/g,"").replace(/#([0-9]+)/g,function(a,c){return b[c]})},asPath:function(a){for(var b=a.split(";"),c="$",d=1,e=b.length;e>d;d++)c+=/^[0-9*]+$/.test(b[d])?"["+b[d]+"]":"['"+b[d]+"']";return c},store:function(a,b){return a&&(P.result[P.result.length]="PATH"==P.resultType?P.asPath(a):b),!!a},trace:function(a,b,c){if(a){var d=a.split(";"),e=d.shift();if(d=d.join(";"),b&&b.hasOwnProperty(e))P.trace(d,b[e],c+";"+e);else if("*"===e)P.walk(e,d,b,c,function(a,b,c,d,e){P.trace(a+";"+c,d,e)});else if(".."===e)P.trace(d,b,c),P.walk(e,d,b,c,function(a,b,c,d,e){"object"==typeof d[a]&&P.trace("..;"+c,d[a],e+";"+a)});else if(/,/.test(e))for(var f=e.split(/'?,'?/),g=0,h=f.length;h>g;g++)P.trace(f[g]+";"+d,b,c);else/^\(.*?\)$/.test(e)?P.trace(P.eval(e,b,c.substr(c.lastIndexOf(";")+1))+";"+d,b,c):/^\?\(.*?\)$/.test(e)?P.walk(e,d,b,c,function(a,b,c,d,e){P.eval(b.replace(/^\?\((.*?)\)$/,"$1"),d[a],a)&&P.trace(a+";"+c,d,e)}):/^(-?[0-9]*):(-?[0-9]*):?([0-9]*)$/.test(e)&&P.slice(e,d,b,c)}else P.store(c,b)},walk:function(a,b,c,d,e){if(c instanceof Array)for(var f=0,g=c.length;g>f;f++)f in c&&e(f,a,b,c,d);else if("object"==typeof c)for(var h in c)c.hasOwnProperty(h)&&e(h,a,b,c,d)},slice:function(a,b,c,d){if(c instanceof Array){var e=c.length,f=0,g=e,h=1;a.replace(/^(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)$/g,function(a,b,c,d){f=parseInt(b||f),g=parseInt(c||g),h=parseInt(d||h)}),f=0>f?Math.max(0,f+e):Math.min(e,f),g=0>g?Math.max(0,g+e):Math.min(e,g);for(var i=f;g>i;i+=h)P.trace(i+";"+b,c,d)}},eval:function(x,_v,_vname){try{return $&&_v&&eval(x.replace(/@/g,"_v"))}catch(e){throw new SyntaxError("jsonPath: "+e.message+": "+x.replace(/@/g,"_v").replace(/\^/g,"_a"))}}},$=obj;return expr&&obj&&("VALUE"==P.resultType||"PATH"==P.resultType)?(P.trace(P.normalize(expr).replace(/^\$;/,""),obj,"$"),P.result.length?P.result:!1):void 0}define("jsonpath",function(a){return function(){var b;return b||a.jsonPath}}(this)),define("panels/microtable/module",["angular","app","lodash","kbn","moment","jsonpath","angular-ui-grid"],function(a,b,c,d,e){"use strict";var f=a.module("kibana.panels.microtable",[]);b.useModule(f),f.controller("microtable",["$rootScope","$scope","$modal","$q","$compile","$timeout","fields","querySrv","dashboard","filterSrv","$filter","$http","searchSvr","elasticsearchClient",function(b,d,e,f,g,h,i,j,k,l,m,n,o,p){d.panelMeta={modals:[{description:"检查",icon:"icon-info-sign",partial:"app/partials/inspector.html",show:d.panel.spyable}],editorTabs:[{title:"附加条件",src:"app/partials/condition.html"}]};var q={fields:[],timeField:"@timestamp",queries:{mode:"all",ids:[]},style:{"font-size":"9pt"},normTimes:!0,query:{list:{},ids:[]},filter:{list:{},ids:[]},sql:"",searchIndex:"",span:12};c.defaults(d.panel,q),d.query=d.panel.query,d.filter=d.panel.filter,d.init=function(){d.$on("refresh",function(){d.getPagedDataAsync(d.pagingOptions.pageSize,d.pagingOptions.currentPage)}),d.getPagedDataAsync(d.pagingOptions.pageSize,d.pagingOptions.currentPage)},d.filterOptions={filterText:"",useExternalFilter:!0},d.totalServerItems=0,d.pagingOptions={pageSizes:[20,50,100,500,1e3],pageSize:100,currentPage:1},d.setPagingData=function(a,b,c,e){d.myData=a,d.totalServerItems=e,d.$$phase||d.$apply()},d.getPagedDataAsync=function(b,c,e){d.panelMeta.loading=!0,setTimeout(function(){var f=d.panel,g=f.dstype,h=o.doSearch(f,d.query,d.filter,d.pagingOptions);h.then(function(f){if("search"===g){var h=f.hits,i=h.total,j=[];if(a.forEach(h.hits,function(a){var b=a._source;j.push(b)}),e){var k=e.toLowerCase();j=f.filter(function(a){return-1!=JSON.stringify(a).toLowerCase().indexOf(k)}),d.setPagingData(j,c,b,i)}else d.setPagingData(j,c,b,i);d.panelMeta.loading=!1}else{var l=f.result.heads,m=f.result.body,j=[];if(a.forEach(m,function(b,c){var d={};a.forEach(b,function(a,b){d[l[b]]=a}),j.push(d)}),e){var k=e.toLowerCase();j=largeLoad.filter(function(a){return-1!=JSON.stringify(a).toLowerCase().indexOf(k)}),d.setPagingData(j,c,b,i)}else d.setPagingData(j,c,b,i);d.panelMeta.loading=!1}})},100)},d.$watch("pagingOptions",function(a,b){a!==b&&a.currentPage!==b.currentPage&&d.getPagedDataAsync(d.pagingOptions.pageSize,d.pagingOptions.currentPage,d.filterOptions.filterText)},!0),d.$watch("filterOptions",function(a,b){a!==b&&d.getPagedDataAsync(d.pagingOptions.pageSize,d.pagingOptions.currentPage,d.filterOptions.filterText)},!0),d.gridOptions={data:"myData",enablePaging:!0,enableColumnResize:!0,showFooter:!0,enableRowSelection:!1,enableSorting:!1,enableColumnReordering:!0,enableRowReordering:!0,totalServerItems:"totalServerItems",pagingOptions:d.pagingOptions,filterOptions:d.filterOptions},d.populate_modal=function(b){d.inspector=a.toJson(JSON.parse(b.toString()),!0)},d.ds_change=function(b){var c=o.getConfig(b);d.list=c,c.then(function(b){a.isUndefined(d.panel.tablename)&&(d.panel.tablename=b[0]),d.field_change_with_table(d.panel.tablename)})},d.field_change_with_table=function(b){a.isUndefined(b)&&(b=d.panel.tablename),a.isUndefined(b)||(d.tablenamefields=b.fields,d.panel.tablenamefields=d.tablenamefields[0]),d.current_tablename=b,d.current_tablenamefields=d.panel.tablenamefields},d.current_option_change=function(a){d.field_change_with_table(a)},d.set_refresh=function(a){d.refresh=a},d.close_edit=function(){d.refresh&&d.getPagedDataAsync(d.pagingOptions.pageSize,d.pagingOptions.currentPage),d.refresh=!1}}])});